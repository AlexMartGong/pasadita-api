# =============================================================================
# LA PASADITA API - Production Configuration
# =============================================================================
# Activate with: java -jar app.jar --spring.profiles.active=prod
# Or: SPRING_PROFILES_ACTIVE=prod java -jar app.jar
# =============================================================================

spring.application.name=pasadita-api
server.port=8080

# =============================================================================
# CORS Configuration - Production
# =============================================================================
cors.allowed-origins=https://lapasadita.app

# =============================================================================
# Database Configuration - Aiven MySQL
# =============================================================================
# Connection URL with SSL required for Aiven
spring.datasource.url=${DB_URL}
spring.datasource.username=${DB_USERNAME}
spring.datasource.password=${DB_PASSWORD}
spring.datasource.driver-class-name=com.mysql.cj.jdbc.Driver

# =============================================================================
# HikariCP Connection Pool - Optimized for 2GB RAM Droplet + Aiven Free Tier
# =============================================================================
# Aiven Free Tier typically allows ~25 connections, we use 10 to leave headroom
spring.datasource.hikari.maximum-pool-size=10
spring.datasource.hikari.minimum-idle=3
spring.datasource.hikari.idle-timeout=300000
spring.datasource.hikari.max-lifetime=600000
spring.datasource.hikari.connection-timeout=20000
spring.datasource.hikari.validation-timeout=5000
spring.datasource.hikari.leak-detection-threshold=60000
spring.datasource.hikari.pool-name=PasaditaHikariPool

# Keep connections alive with periodic validation
spring.datasource.hikari.keepalive-time=120000
spring.datasource.hikari.connection-test-query=SELECT 1

# =============================================================================
# JPA/Hibernate Configuration - Production
# =============================================================================
spring.jpa.properties.hibernate.dialect=org.hibernate.dialect.MySQLDialect
spring.jpa.hibernate.ddl-auto=validate
spring.jpa.show-sql=false
spring.jpa.properties.hibernate.format_sql=false
spring.jpa.open-in-view=false

# Batch processing for better performance
spring.jpa.properties.hibernate.jdbc.batch_size=25
spring.jpa.properties.hibernate.order_inserts=true
spring.jpa.properties.hibernate.order_updates=true

# =============================================================================
# JWT Configuration - Use strong secret in production
# =============================================================================
jwt.secret=${JWT_SECRET}
jwt.expiration=${JWT_EXPIRATION:86400000}

# =============================================================================
# Server Configuration - Production
# =============================================================================
server.error.include-message=never
server.error.include-stacktrace=never
server.error.include-binding-errors=never

# Compression for better performance
server.compression.enabled=true
server.compression.mime-types=application/json,application/xml,text/html,text/xml,text/plain
server.compression.min-response-size=1024

# Connection limits
server.tomcat.max-connections=200
server.tomcat.accept-count=100
server.tomcat.threads.max=50
server.tomcat.threads.min-spare=10

# =============================================================================
# Logging Configuration - Production
# =============================================================================
logging.level.root=WARN
logging.level.com.pasadita.api=INFO
logging.level.org.springframework.security=WARN
logging.level.org.hibernate.SQL=WARN
logging.level.com.zaxxer.hikari=INFO

# =============================================================================
# Actuator (optional - for health checks)
# =============================================================================
management.endpoints.web.exposure.include=health,info
management.endpoint.health.show-details=never
